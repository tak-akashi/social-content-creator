---
description: ドキュメント品質レビュー
---

# ドキュメント品質レビュー

**目的:** `docs/core/`、`CLAUDE.md`、`README.md`のドキュメント品質をレビューし、改善提案を行います。

**引数:**
- `/review-docs` - 全ドキュメントをレビュー（CLAUDE.md、README.md含む）
- `/review-docs [ファイル名]` - 指定したドキュメントをレビュー（例: `architecture.md`）
- `/review-docs [モジュール名]` - 指定したモジュールに関連するドキュメントのみをレビュー（例: `jquants`）
- `/review-docs [steeringフォルダ名]` - `.steering/` 内のフォルダを指定し、その機能に関連するドキュメントのみをレビュー（例: `20260207-slack-notification`）

**フォルダ名 vs その他の判定:**
- `YYYYMMDD-` 形式（例: `20260207-slack-notification`）で始まる場合 → steeringフォルダ指定
- それ以外 → 従来のファイル名/モジュール名判定

**出力:**
- steeringフォルダ指定時: `.steering/[フォルダ名]/review-report.md` に保存（既存ファイルがある場合は `review-report-N.md` で連番付与）
- それ以外: `.steering/YYYYMMDD-docs-review/review-report.md` に保存（同一フォルダ内に既存ファイルがある場合は `review-report-N.md` で連番付与）

---

## レビュー観点

| # | 観点 | 内容 |
|---|------|------|
| 1 | 完全性 | 全モジュール・APIが文書化されているか |
| 2 | 最新性 | コードの変更がドキュメントに反映されているか |
| 3 | 正確性 | 記述が実際のコードと一致しているか |
| 4 | 分かりやすさ | 読みやすく理解しやすいか |
| 5 | 一貫性 | 命名・フォーマットが統一されているか |

---

## ステップ1: レビュー対象の特定

### 1.1 対象ファイルの特定

```
# 引数の種類を判定
引数 = $ARGUMENTS

# ケース1: 引数なし（全ファイル）
if 引数 == "":
    Glob('docs/core/*.md')
    Read('CLAUDE.md')
    Read('README.md')
    → 全ファイルをレビュー対象に

# ケース2: steeringフォルダ指定時（YYYYMMDD- 形式で始まる）
elif 引数が 'YYYYMMDD-' 形式で始まる:
    # → ステップ1.5へ進む

# ケース3: ファイル名指定時（.mdを含むか既知のドキュメント名）
elif 引数 in ['architecture', 'functional-design', 'repository-structure',
              'development-guidelines', 'glossary', 'api-reference',
              'diagrams', 'CHANGELOG', 'CLAUDE', 'README'] or 引数.endswith('.md'):
    # ドキュメントファイルを特定
    if 引数 == 'CLAUDE' or 引数 == 'CLAUDE.md':
        Read('CLAUDE.md')
    elif 引数 == 'README' or 引数 == 'README.md':
        Read('README.md')
    else:
        Read('docs/core/[引数].md')

# ケース4: モジュール名指定時（上記以外 → モジュール名と判定）
else:
    モジュール名 = 引数
    # モジュールの存在確認
    Glob('core/{モジュール名}/**/*.py')
    Glob('src/{モジュール名}/**/*.py')

    # 関連ドキュメントを特定（モジュール名が言及されているドキュメント）
    Grep(モジュール名, 'docs/core/')
    Grep(モジュール名, 'CLAUDE.md')
    Grep(モジュール名, 'README.md')
    → モジュールに関連するセクションのみをレビュー対象に
```

### 1.2 steeringフォルダ指定時の処理（ステップ1.5）

steeringフォルダが指定された場合、設計書から関連モジュールを自動特定し、スコープを絞ったレビューを行います。

#### 1.2.1 steeringフォルダの読み込み

```
フォルダパス = '.steering/[引数]'

# フォルダの存在確認
Glob('.steering/[引数]/')

# 存在しない場合はエラー
if フォルダが存在しない:
    "エラー: `.steering/[引数]/` が見つかりません。"
    → 処理終了

# 設計書の読み込み
Read('.steering/[引数]/requirements.md')
Read('.steering/[引数]/design.md')
Read('.steering/[引数]/tasklist.md')
```

#### 1.2.2 関連モジュール・ファイルの特定

```
# design.mdから実装対象のファイルパスを抽出
# （変更対象ファイル、新規作成ファイル等のセクションから）
実装ファイルリスト = design.mdに記載されたソースファイルパス一覧

# tasklist.mdから追加のファイルパスを抽出（テストファイル等）
テストファイルリスト = tasklist.mdに記載されたテストファイルパス一覧

# requirements.mdからキーワードを抽出（クラス名、機能名等）
関連キーワード = requirements.mdに記載された主要クラス名・機能名

# 関連するdocs/core/のセクションを特定
for キーワード in 関連キーワード:
    Grep(キーワード, 'docs/core/')
    Grep(キーワード, 'CLAUDE.md')
    Grep(キーワード, 'README.md')
→ 関連セクションのみをレビュー対象に
```

#### 1.2.3 レビュー範囲

steeringフォルダが指定された場合、以下をレビューします：

**A. steering設計書自体のレビュー（設計書品質チェック）:**

| ファイル | チェック内容 |
|----------|-------------|
| `requirements.md` | 受け入れ条件が全てtasklist.mdのタスクに紐づいているか |
| `design.md` | 記載ファイルパスが実際に存在するか、シグネチャが実装と一致するか |
| `tasklist.md` | 全タスクが完了(`[x]`)しているか |

**B. docs/core/ の関連セクションレビュー:**

| ドキュメント | レビュー範囲 |
|-------------|-------------|
| `architecture.md` | 実装モジュールが属するコンポーネントのセクション |
| `repository-structure.md` | 実装ファイルのディレクトリ説明セクション |
| `api-reference.md` | 実装クラス/関数のAPI記載セクション |
| `CLAUDE.md` | 実装モジュールの説明セクション |
| `README.md` | 実装モジュールへの参照箇所 |
| `CHANGELOG.md` | 該当機能の変更履歴が記載されているか |

### 1.3 モジュール名指定時のレビュー範囲

モジュール名が指定された場合、以下のドキュメントの関連セクションのみをレビューします：

| ドキュメント | レビュー範囲 |
|-------------|-------------|
| `architecture.md` | モジュールが属するコンポーネントのセクション |
| `repository-structure.md` | モジュールのディレクトリ説明セクション |
| `api-reference.md` | モジュールのAPI記載セクション |
| `CLAUDE.md` | モジュールの説明セクション |
| `README.md` | モジュールへの参照箇所 |

### 1.4 対象ドキュメント一覧

**プロジェクトルートドキュメント（必須レビュー対象）:**

| ファイル | 内容 | 備考 |
|----------|------|------|
| `CLAUDE.md` | 開発ガイダンス・AI支援用情報 | **常にレビュー対象** |
| `README.md` | プロジェクト概要・使い方 | **常にレビュー対象** |

**コアドキュメント (docs/core/):**

| ファイル | 内容 | 備考 |
|----------|------|------|
| `architecture.md` | アーキテクチャ設計 | |
| `functional-design.md` | 機能設計 | |
| `repository-structure.md` | リポジトリ構造 | `repo-structure.md`の場合あり |
| `development-guidelines.md` | 開発ガイドライン | `dev-guidelines.md`の場合あり |
| `glossary.md` | 用語集 | |

**オプションドキュメント (docs/core/):**

| ファイル | 内容 | 備考 |
|----------|------|------|
| `api-reference.md` | API仕様 | |
| `diagrams.md` | Mermaid図 | |
| `CHANGELOG.md` | 変更履歴 | |
| `product-requirements.md` | プロダクト要件定義 | 新規プロジェクトのみ |

---

## ステップ2: 完全性チェック

**目的:** 全ての情報が網羅されているか確認します。

**注意:** モジュール名またはsteeringフォルダが指定された場合は、関連する部分のみチェックします。

### 2.1 モジュールカバレッジ

```
# 実際のモジュール一覧を取得
if steeringフォルダ指定あり:
    # design.mdから特定した実装ファイルリストを使用
    for ファイルパス in 実装ファイルリスト:
        Glob(ファイルパス)
    → 実装ファイルリストをモジュールリストとして使用
elif モジュール指定あり:
    Glob('core/{モジュール名}/**/*.py')
    Glob('src/{モジュール名}/**/*.py')
else:
    Glob('core/**/*.py')
    Glob('src/**/*.py')
→ モジュールリストを作成

# ドキュメントに記載されているモジュールを抽出
Read('docs/core/repository-structure.md')
Read('docs/core/api-reference.md')
Read('CLAUDE.md')  # Key Modulesセクション等
→ 記載モジュールリストを作成

# 差分を確認
未記載モジュール = 実際モジュール - 記載モジュール
```

### 2.2 API カバレッジ

```
# 公開クラス/関数を抽出
if steeringフォルダ指定あり:
    # design.mdから特定した実装ファイルのみ対象
    for ファイルパス in 実装ファイルリスト:
        Grep('class [A-Z]|def [a-z]', ファイルパス)
elif モジュール指定あり:
    Grep('class [A-Z]|def [a-z]', 'core/{モジュール名}/')
else:
    Grep('class [A-Z]|def [a-z]', 'core/')
→ 公開API一覧

# api-reference.mdの記載を確認
Read('docs/core/api-reference.md')
→ 記載API一覧

# カバレッジを計算
カバレッジ率 = 記載API / 公開API * 100
```

### 2.3 チェック項目

| 項目 | 基準 | 確認方法 |
|------|------|----------|
| モジュールカバレッジ | 100% | Glob + 文書比較 |
| クラスカバレッジ | 100% | Grep + 文書比較 |
| 公開関数カバレッジ | 90%以上 | Grep + 文書比較 |
| 設定項目カバレッジ | 100% | .env + src/config.py + 文書比較 |

---

## ステップ3: 最新性チェック

**目的:** ドキュメントが最新のコードを反映しているか確認します。

### 3.1 更新日の確認

```bash
# ドキュメントの最終更新日
Bash('git log -1 --format="%ai" docs/core/')

# コードの最終更新日
Bash('git log -1 --format="%ai" src/')

# 最近変更されたファイルとドキュメントの対応
Bash('git diff --name-only HEAD~10 -- src/')
```

### 3.2 チェック項目

| 項目 | 基準 | 確認方法 |
|------|------|----------|
| ドキュメント更新間隔 | コード更新から7日以内 | git log比較 |
| 変更されたモジュール | 対応するドキュメントが更新済み | git diff確認 |
| 削除されたファイル | ドキュメントから削除済み | Glob + 文書比較 |

---

## ステップ4: 正確性チェック

**目的:** 記述が実際のコードと一致しているか確認します。

### 4.1 シグネチャの検証

```
# ドキュメントに記載されているシグネチャを抽出
Read('docs/core/api-reference.md')
→ 記載シグネチャ一覧

# 実際のコードのシグネチャと比較
for シグネチャ in 記載シグネチャ:
    Grep(シグネチャ, 'src/')
    → 一致しなければ乖離として記録
```

### 4.2 パス・ファイル名の検証

```
# ドキュメント内のパスを抽出
Read('docs/core/repository-structure.md')
→ 記載パス一覧

# 実際の存在確認
for パス in 記載パス:
    Glob(パス)
    → 存在しなければ古い情報として記録
```

### 4.3 チェック項目

| 項目 | 確認内容 |
|------|----------|
| クラス名 | 実際のクラス名と一致 |
| メソッドシグネチャ | 引数・戻り値が一致 |
| ファイルパス | 実際に存在 |
| 設定キー | .env または src/config.py に存在 |
| コマンド | pyproject.tomlに定義 |

### 4.4 README.md のチェック

| 項目 | 確認内容 |
|------|----------|
| プロジェクト構造 | src/ のディレクトリ構造と一致 |
| コマンド名 | pyproject.toml の [project.scripts] と一致 |
| 削除されたファイル | 存在しないファイルへの参照がないか |

### 4.5 CLAUDE.md のチェック

| 項目 | 確認内容 |
|------|----------|
| コンポーネント一覧 | src/ のモジュール構造と一致 |
| コマンド名 | pyproject.toml の [project.scripts] と一致 |
| 外部依存関係 | pyproject.toml の依存関係と一致 |

---

## ステップ5: 分かりやすさチェック

**目的:** 読み手が理解しやすい内容になっているか確認します。

### 5.1 説明の充実度

| 項目 | 基準 |
|------|------|
| 概要 | 各セクションに概要説明あり |
| 使用例 | 主要機能にコード例あり |
| パラメータ | 全引数に説明あり |
| 戻り値 | 関数の戻り値に説明あり |
| 段落の長さ | 1段落5行以内推奨 |

### 5.2 曖昧表現の検出

```
# 曖昧な表現を検出
Grep('適宜|必要に応じて|など|等|〜的な|ある程度|いい感じ', 'docs/core/')
Grep('適宜|必要に応じて|など|等|〜的な|ある程度|いい感じ', 'CLAUDE.md')
Grep('適宜|必要に応じて|など|等|〜的な|ある程度|いい感じ', 'README.md')

# 具体性が不足している箇所を特定
```

### 5.3 チェック項目

| 項目 | 確認内容 |
|------|----------|
| 概要説明 | 各セクション冒頭に目的・概要あり |
| コード例 | 主要APIに使用例あり |
| エラー説明 | エラー時の挙動が記載 |
| 前提条件 | 必要な環境・依存が記載 |

---

## ステップ6: 一貫性チェック

**目的:** 命名規則やフォーマットが統一されているか確認します。

### 6.1 命名規則

```
# ドキュメント内の命名パターンを分析
Read('docs/core/*.md')
Read('CLAUDE.md')
Read('README.md')

チェック項目:
- クラス名: PascalCase
- 関数名: snake_case
- 定数: UPPER_SNAKE_CASE
- ファイル名: kebab-case または snake_case
```

### 6.2 フォーマット統一

| 項目 | 期待するフォーマット |
|------|----------------------|
| 見出しレベル | # → ## → ### の順序 |
| コードブロック | 言語指定あり |
| リスト | 統一されたマーカー（- または *） |
| テーブル | ヘッダー + 区切り線 |

### 6.3 用語の統一

```
# 用語の揺れを検出
同じ概念に対する異なる表現:
- "Collector" vs "コレクター"
- "設定ファイル" vs "config" vs "settings"
- "実行する" vs "起動する" vs "動かす"
```

---

## ステップ7: レビューレポートの生成

### 出力形式

```markdown
# ドキュメントレビューレポート

> 生成日時: {YYYY-MM-DD HH:MM}
> 対象: {ファイル名 / モジュール名 / 全ファイル}
> 対象モジュール: {モジュール名（モジュール指定時のみ）}

## サマリー

| 観点 | 評価 | 問題数 |
|------|------|--------|
| 完全性 | {A/B/C/D} | {N}件 |
| 最新性 | {A/B/C/D} | {N}件 |
| 正確性 | {A/B/C/D} | {N}件 |
| 分かりやすさ | {A/B/C/D} | {N}件 |
| 一貫性 | {A/B/C/D} | {N}件 |
| **総合評価** | **{A/B/C/D}** | **{N}件** |

### レビュー対象ファイル

| ファイル | レビュー済 | 問題数 |
|----------|-----------|--------|
| CLAUDE.md | ✅ | {N}件 |
| README.md | ✅ | {N}件 |
| docs/core/*.md | ✅ | {N}件 |

## 1. 完全性

### 未記載モジュール
| モジュール | 推奨対応 |
|------------|----------|
| `src/company_research_agent/xxx.py` | repository-structure.mdに追加 |

### 未記載API
| クラス/関数 | ファイル | 推奨対応 |
|-------------|----------|----------|
| `XxxClass` | `xxx.py` | api-reference.mdに追加 |

## 2. 最新性

### 更新が必要なドキュメント
| ドキュメント | 最終更新 | 関連コード更新 |
|--------------|----------|----------------|
| api-reference.md | 2025-01-01 | 2025-01-20 |

### 最近変更されたコード
| ファイル | 変更日 | ドキュメント反映 |
|----------|--------|------------------|
| `xxx.py` | 2025-01-20 | 未反映 |

## 3. 正確性

### コードとの乖離
| 項目 | ドキュメント | 実際 | ファイル |
|------|--------------|------|----------|
| メソッド名 | `old_name()` | `new_name()` | api-reference.md |

### 存在しないパス
| 記載パス | ファイル | 推奨対応 |
|----------|----------|----------|
| `src/old_module.py` | repository-structure.md | 削除または更新 |

## 4. 分かりやすさ

### 説明不足
| 項目 | ファイル | 推奨対応 |
|------|----------|----------|
| `XxxClass` | api-reference.md | 概要説明を追加 |
| `fetch()` | api-reference.md | 使用例を追加 |

### 曖昧な記述
| 記述 | ファイル | 推奨修正 |
|------|----------|----------|
| "適切に処理する" | xxx.md:20 | 具体的な処理内容を記載 |

## 5. 一貫性

### 命名の不統一
| 項目 | 出現パターン | 推奨 |
|------|--------------|------|
| Collector | "Collector", "コレクター" | "Collector" に統一 |

### フォーマットの不統一
| 問題 | 場所 | 推奨対応 |
|------|------|----------|
| コードブロックに言語指定なし | architecture.md:45 | ```python を使用 |

## 6. 改善提案

### 優先度: 高
- [ ] {問題}: {対応方法}

### 優先度: 中
- [ ] {問題}: {対応方法}

### 優先度: 低
- [ ] {問題}: {対応方法}

## 7. 次のアクション

- [ ] `/update-docs` を実行して自動更新
- [ ] 手動で {ファイル} を修正
- [ ] gen-* コマンドで再生成を検討
```

---

## 評価基準

| 評価 | 基準 |
|------|------|
| **A** | 問題なし |
| **B** | 軽微な問題1-3件 |
| **C** | 問題4-10件 |
| **D** | 問題10件以上または重大な問題あり |

### 総合評価

- **A**: 全観点がA
- **B**: 最低評価がB
- **C**: 最低評価がC
- **D**: 1つでもDがある

---

## ステップ8: レポートの保存

レビュー完了後、レポートを `.steering/` ディレクトリに保存します。

### 8.1 保存先の確認と作成

```
if steeringフォルダ指定あり:
    # steeringフォルダ内に保存
    folder = '.steering/[指定されたフォルダ名]'

else:
    # 日付ベースのフォルダ名（従来の動作）
    folder = '.steering/YYYYMMDD-docs-review'
    Bash('mkdir -p {folder}')

# 既存のreview-report.mdがあるか確認
Glob('{folder}/review-report*.md')

# 存在する場合はファイル名に連番を付与
if 既存レポートあり:
    filename = 'review-report-N.md'  # Nは次の連番
else:
    filename = 'review-report.md'
```

### 8.2 レポートの保存

```
# レビューレポートを保存
Write('{folder}/{filename}', レポート内容)
```

### 8.3 命名規則

**全モード共通（フォルダは固定、ファイル名に連番付与）:**

| パターン | 例（steeringフォルダ指定時） | 例（従来モード） |
|----------|------|------|
| 初回 | `.steering/20260207-slack-notification/review-report.md` | `.steering/20250129-docs-review/review-report.md` |
| 2回目 | `.steering/20260207-slack-notification/review-report-2.md` | `.steering/20250129-docs-review/review-report-2.md` |
| 3回目 | `.steering/20260207-slack-notification/review-report-3.md` | `.steering/20250129-docs-review/review-report-3.md` |

---

## 注意事項

- レビューは読み取りのみで、ドキュメントを変更しません
- レビューレポートは `.steering/` に自動保存されます
- 自動検出には限界があるため、人間による確認も推奨
- 問題の修正は `/update-docs` または手動で行ってください
